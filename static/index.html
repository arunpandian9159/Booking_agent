<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Booking Agent Demo</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            background: linear-gradient(120deg, #f6d365 0%, #fda085 100%);
            min-height: 100vh;
            margin: 0;
        }
        .container {
            max-width: 420px;
            margin: 3em auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            padding: 2.5em 2em 2em 2em;
        }
        h2 {
            text-align: center;
            color: #f76b1c;
            margin-bottom: 1.5em;
        }
        label {
            display: block;
            margin-top: 1.2em;
            font-weight: 700;
            color: #333;
        }
        select, input {
            width: 100%;
            padding: 0.7em;
            margin-top: 0.5em;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            background: #fafafa;
            transition: border 0.2s;
        }
        select:focus, input:focus {
            border: 1.5px solid #f76b1c;
            outline: none;
        }
        button {
            width: 100%;
            padding: 0.8em;
            margin-top: 1.5em;
            background: linear-gradient(90deg, #f76b1c 0%, #fad961 100%);
            color: #fff;
            font-weight: 700;
            border: none;
            border-radius: 6px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(247,107,28,0.08);
        }
        button:hover {
            background: linear-gradient(90deg, #fad961 0%, #f76b1c 100%);
        }
        #result {
            margin-top: 2em;
            padding: 1.2em 1em;
            border: 1.5px solid #f76b1c;
            border-radius: 8px;
            background: #fff7f0;
            min-height: 2em;
            font-size: 1.05em;
            color: #333;
            box-shadow: 0 2px 8px rgba(247,107,28,0.04);
        }
        .section-title {
            font-weight: 700;
            color: #f76b1c;
            margin-top: 1em;
            margin-bottom: 0.3em;
        }
        .error {
            color: #d32f2f;
            font-weight: 700;
        }
        @media (max-width: 500px) {
            .container { padding: 1.2em 0.5em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Travel Booking Agent</h2>
        <form id="bookingForm">
            <label for="plan">Select Plan:</label>
            <select id="plan" name="plan">
                <option value="">Loading...</option>
            </select>
            <label for="customer">Your Name:</label>
            <input type="text" id="customer" name="customer" required placeholder="Enter your name" />
            <label for="date">Select Departure Date:</label>
            <input type="date" id="date" name="date" required min="2024-01-01" />
            <button type="submit">Book Now</button>
        </form>
        <div id="result"></div>
    </div>
    <script>
        // Fetch available plans from backend
        fetch('/plans')
            .then(res => res.json())
            .then(data => {
                const planSelect = document.getElementById('plan');
                planSelect.innerHTML = '';
                if (data.plans.length === 0) {
                    const opt = document.createElement('option');
                    opt.value = '';
                    opt.textContent = 'No plans available';
                    planSelect.appendChild(opt);
                } else {
                    data.plans.forEach(plan => {
                        const opt = document.createElement('option');
                        opt.value = plan.name;
                        opt.textContent = plan.name;
                        planSelect.appendChild(opt);
                    });
                }
            });

        function formatBookingResult(raw) {
            // Example input: "Booking for arun with plan 'Tokyo Adventure' is complete. A flight has been booked from LAX to HND on 2025-07-31 for 404.18 EUR. However, the hotel search failed with the following error: INVALID FORMAT: Parameter not found in collection. Required parameter: hotelIds. Enjoy your trip"
            const match = raw.match(/Booking for (.+) with plan '(.+)' is complete. A flight has been booked from (.+) to (.+) on (\\d{4}-\\d{2}-\\d{2}) for ([\\d.]+ EUR). However, the hotel search failed with the following error: (.+)\\. Enjoy your trip/i);
            if (match) {
                const [, customer, plan, from, to, date, price, hotelError] = match;
                return `
                    <div class="section-title">Booking Confirmation for ${customer.charAt(0).toUpperCase() + customer.slice(1)}</div>
                    <div><b>Plan:</b> ${plan}</div>
                    <div><b>Status:</b> <span style="color:green;">&#x2705; Complete</span></div>
                    <hr/>
                    <div class="section-title">‚úàÔ∏è Flight Details</div>
                    <ul>
                        <li><b>From:</b> ${from}</li>
                        <li><b>To:</b> ${to}</li>
                        <li><b>Date:</b> ${date}</li>
                        <li><b>Price:</b> ${price}</li>
                        <li><b>Status:</b> Booked Successfully</li>
                    </ul>
                    <div class="section-title">üè® Hotel Details</div>
                    <ul>
                        <li><b>Status:</b> <span style="color:#d32f2f;">&#x274C; Not Booked</span></li>
                        <li><b>Reason:</b> <i>${hotelError}</i></li>
                    </ul>
                    <div style="margin-top:1em;font-style:italic;color:#388e3c;">Enjoy your trip, ${customer.charAt(0).toUpperCase() + customer.slice(1)}!</div>
                `;
            }
            // fallback to previous formatting
            return `<span class="error">${raw}</span>`;
        }

        document.getElementById('bookingForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const plan = document.getElementById('plan').value;
            const customer = document.getElementById('customer').value;
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<em>Processing...</em>';
            const date = document.getElementById('date').value;
            try {
                const res = await fetch('/select_plan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ plan, customer, date })
                });
                const data = await res.json();
                resultDiv.innerHTML = formatBookingResult(data.result || data.status);
            } catch (err) {
                resultDiv.innerHTML = `<span class="error">Network error. Please try again.</span>`;
            }
        });
    </script>
</body>
</html> 